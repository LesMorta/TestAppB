<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:TestAppB.Models"
             BackgroundColor="#f5f9f2"
             x:Class="TestAppB.Views.MyPlantsPage">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Style x:Key="PageTitleStyle" TargetType="Label">
                <Setter Property="TextColor" Value="#2E7D32"/>
                <Setter Property="FontSize" Value="24"/>
                <Setter Property="FontAttributes" Value="Bold"/>
                <Setter Property="HorizontalTextAlignment" Value="Center"/>
                <Setter Property="Margin" Value="0,20,0,10"/>
            </Style>

            <Style x:Key="EmptyPlantStyle" TargetType="Label">
                <Setter Property="TextColor" Value="#546E7A"/>
                <Setter Property="FontSize" Value="16"/>
                <Setter Property="HorizontalTextAlignment" Value="Center"/>
                <Setter Property="Margin" Value="20,40"/>
            </Style>

            <Style x:Key="AddButtonStyle" TargetType="Button">
                <Setter Property="BackgroundColor" Value="#66BB6A"/>
                <Setter Property="TextColor" Value="White"/>
                <Setter Property="CornerRadius" Value="25"/>
                <Setter Property="FontAttributes" Value="Bold"/>
                <Setter Property="FontSize" Value="16"/>
                <Setter Property="HeightRequest" Value="50"/>
                <Setter Property="Margin" Value="20,10"/>
            </Style>

            <Style x:Key="PlantNameStyle" TargetType="Label">
                <Setter Property="FontSize" Value="18"/>
                <Setter Property="FontAttributes" Value="Bold"/>
                <Setter Property="TextColor" Value="#2E7D32"/>
                <Setter Property="VerticalOptions" Value="Center"/>
            </Style>

            <Style x:Key="PlantInfoStyle" TargetType="Label">
                <Setter Property="FontSize" Value="12"/>
                <Setter Property="TextColor" Value="#546E7A"/>
                <Setter Property="VerticalOptions" Value="Center"/>
            </Style>

            <Style x:Key="WaterButtonStyle" TargetType="Button">
                <Setter Property="CornerRadius" Value="20"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="HeightRequest" Value="35"/>
                <Setter Property="WidthRequest" Value="120"/>
                <Setter Property="FontAttributes" Value="Bold"/>
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto, Auto, Auto, *">
        <!-- Заголовок -->
        <Label Grid.Row="0" 
               Text="🌱 Мои растения"
               Style="{StaticResource PageTitleStyle}"/>

        <!-- Статистика -->
        <Frame Grid.Row="1" 
               BackgroundColor="White" 
               CornerRadius="20" 
               Padding="20" 
               Margin="15,5,15,10"
               HasShadow="True"
               BorderColor="#E0F2F1">
            <Grid ColumnDefinitions="*, Auto, *">
                <StackLayout HorizontalOptions="Center" Grid.Column="0">
                    <Label Text="Всего растений" 
                           TextColor="#546E7A" 
                           FontSize="12" 
                           HorizontalTextAlignment="Center"/>
                    <Label x:Name="totalPlantsLabel" 
                           Text="0" 
                           TextColor="#2E7D32" 
                           FontSize="20" 
                           FontAttributes="Bold" 
                           HorizontalTextAlignment="Center"/>
                </StackLayout>

                <BoxView Grid.Column="1" 
                         BackgroundColor="#E8F5E9" 
                         WidthRequest="1" 
                         VerticalOptions="Fill" 
                         Margin="10,0"/>

                <StackLayout HorizontalOptions="Center" Grid.Column="2">
                    <Label Text="Политы сегодня" 
                           TextColor="#546E7A" 
                           FontSize="12" 
                           HorizontalTextAlignment="Center"/>
                    <Label x:Name="wateredTodayLabel" 
                           Text="0" 
                           TextColor="#388E3C" 
                           FontSize="20" 
                           FontAttributes="Bold" 
                           HorizontalTextAlignment="Center"/>
                </StackLayout>
            </Grid>
        </Frame>

        <!-- Кнопка добавления -->
        <Button Grid.Row="2" 
                Text="➕ Добавить растение" 
                Clicked="AddPlant_Clicked" 
                Style="{StaticResource AddButtonStyle}"/>

        <!-- Список растений или пустая страница -->
        <StackLayout x:Name="emptyState" Grid.Row="3" IsVisible="false" VerticalOptions="CenterAndExpand">
            <Image Source="empty_plants.png" 
                   HeightRequest="150" 
                   Aspect="AspectFit" 
                   Margin="0,0,0,20"/>
            <Label Text="У вас пока нет растений" 
                   Style="{StaticResource EmptyPlantStyle}"/>
            <Label Text="Добавьте свое первое растение и начните ухаживать за ним!" 
                   TextColor="#78909C" 
                   FontSize="14" 
                   HorizontalTextAlignment="Center" 
                   Margin="30,0"/>
        </StackLayout>

        <CollectionView x:Name="plantsList" 
                        Grid.Row="3" 
                        SelectionMode="None" 
                        VerticalScrollBarVisibility="Never">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <SwipeView>
                        <SwipeView.RightItems>
                            <SwipeItems>
                                <SwipeItem Text="Удалить" 
                                          BackgroundColor="#F44336" 
                                          IconImageSource="delete_icon.png"
                                          Invoked="DeletePlant_Invoked" />
                                <SwipeItem Text="Изменить" 
                                          BackgroundColor="#FF9800" 
                                          IconImageSource="edit_icon.png"
                                          Invoked="EditPlant_Invoked" />
                            </SwipeItems>
                        </SwipeView.RightItems>

                        <Frame BackgroundColor="White" 
                               Margin="15,5,15,10" 
                               CornerRadius="20" 
                               Padding="15" 
                               HasShadow="True"
                               BorderColor="#E0F2F1">
                            <Grid ColumnDefinitions="*, Auto">
                                <StackLayout>
                                    <!-- Название растения -->
                                    <Label Text="{Binding Name}" 
                                           Style="{StaticResource PlantNameStyle}">
                                        <Label.GestureRecognizers>
                                            <TapGestureRecognizer NumberOfTapsRequired="1"
                                                                  CommandParameter="{Binding .}"
                                                                  Tapped="OnPlantTapped" />
                                        </Label.GestureRecognizers>
                                    </Label>

                                    <!-- Информация о поливе -->
                                    <Label x:Name="plantInfoLabel"
                                           Style="{StaticResource PlantInfoStyle}"
                                           Margin="0,5,0,0">
                                        <Label.Triggers>
                                            <DataTrigger TargetType="Label" Binding="{Binding IsWatered}" Value="True">
                                                <Setter Property="Text" Value="{Binding LastWatered, StringFormat='Последний полив: {0:dd MMM HH:mm}'}" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Label" Binding="{Binding IsWatered}" Value="False">
                                                <Setter Property="Text" Value="Растению требуется полив" />
                                            </DataTrigger>
                                        </Label.Triggers>
                                    </Label>
                                </StackLayout>

                                <!-- Статус и кнопка полива -->
                                <StackLayout Grid.Column="1" 
                                             VerticalOptions="Center" 
                                             HorizontalOptions="End">
                                    <Button Text="{Binding IsWatered, Converter={StaticResource StatusToTextConverter}}" 
                                            CommandParameter="{Binding .}" 
                                            Clicked="ToggleWatered_Clicked"
                                            Style="{StaticResource WaterButtonStyle}">
                                        <Button.Triggers>
                                            <DataTrigger TargetType="Button" Binding="{Binding IsWatered}" Value="True">
                                                <Setter Property="BackgroundColor" Value="#66BB6A" />
                                                <Setter Property="TextColor" Value="White" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Button" Binding="{Binding IsWatered}" Value="False">
                                                <Setter Property="BackgroundColor" Value="#757575" />
                                                <Setter Property="TextColor" Value="White" />
                                            </DataTrigger>
                                        </Button.Triggers>
                                    </Button>
                                </StackLayout>
                            </Grid>
                        </Frame>
                    </SwipeView>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>